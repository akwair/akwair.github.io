---
title: 数据分析
published: 2025-11-20
description: 数据分析必须要会的那些事
draft: false
---

# 概述

学习数据分析必须要掌握：

- **NumPy**: 数组转化、数值运算、数组操作

- **Pandas**: 数据清洗、转换、聚合
- **Matplotlib/Seaborn**: 数据可视化

掌握了以上的库，你就拥有了基础数据分析的能力。

# 一、Numpy

NumPy（Numerical Python）是Python科学计算的基础库，提供了强大的多维数组对象和丰富的数学函数，是几乎所有数据分析工具的构建基础。

## 1、数组创建

```python
import numpy as np

# 从列表创建
arr1 = np.array([1, 2, 3, 4, 5])
arr2 = np.array([[1, 2, 3], [4, 5, 6]])

# 特殊数组创建
zeros_arr = np.zeros((3, 4))        # 全0数组
ones_arr = np.ones((2, 3))          # 全1数组
empty_arr = np.empty((2, 2))        # 未初始化数组
range_arr = np.arange(0, 10, 2)     # 类似range
linspace_arr = np.linspace(0, 1, 5) # 等间隔数组
```

- numpy.zeros((m, n)):创建m*n大小的全0矩阵
- numpy.ones((m, n)): 创建m*n大小的全1矩阵
- numpy.empty((m, n)):创建m*n大小的未定义矩阵，每个元素的值是随机的
- numpy.arange(m, n, step):创建m到n-1的一维数组，每隔step取一个
- numpy.linspace(m, n, num):创建m到n-1的一维数组，均等分取num个
- numpy.zeros_like(arr): 创建与给定数组形状相同的全0数组
- numpy.ones_like(arr): 创建与给定数组形状相同的全1数组
- numpy.empty_like(arr): 创建与给定数组形状相同的未初始化数组

---

## 2、数组属性

```python
arr = np.array([[1, 2, 3], [4, 5, 6]])

print("数组形状:", arr.shape)        # (2, 3)
print("数组维度:", arr.ndim)         # 2
print("元素总数:", arr.size)         # 6
print("数据类型:", arr.dtype)        # int64
```

- arr.shape：数组的形状（举例来讲二维矩阵的行列数）
- arr.ndim：数组的维度
- arr.size：数组元素的总个数

- arr.dtype：数组中每个元素的类型

---

## 3、数组操作

### 索引与切片

```python
arr = np.array([[1, 2, 3, 4],
                [5, 6, 7, 8],
                [9, 10, 11, 12]])

# 基本索引
print(arr[0, 1])       # 2
print(arr[1, :])       # [5, 6, 7, 8]
print(arr[:, 2])       # [3, 7, 11]

# 布尔索引
bool_idx = arr > 5
print(arr[bool_idx])   # [6, 7, 8, 9, 10, 11, 12]

# 花式索引
print(arr[[0, 2], :])  # 第0行和第2行
```

- -1代表着最后一位元素

- :出现代表着取某一段区间，当:前后没有数字只是分别代表数组开头和结束
- ,分割不同维度
- 索引为左闭右开

### 形状操作

```python
arr = np.arange(12)

# 重塑形状
reshaped = arr.reshape(3, 4)
print("重塑后:\n", reshaped)

# 展平
flattened = arr.flatten()
print("展平后:", flattened)

# 转置
transposed = reshaped.T
print("转置后:\n", transposed)
```

- arr.reshape(m, n):将矩阵形状改变为m*n
- arr.flatten():将数组展开为一维数组
- arr.T:将数组改变为转置矩阵

----

## 4、数组运算

### 简单运算

```python
a = np.array([1, 2, 3])
b = np.array([4, 5, 6])

print("加法:", a + b)        # [5, 7, 9]
print("乘法:", a * b)        # [4, 10, 18] - 逐元素乘法
print("平方:", a ** 2)       # [1, 4, 9]
print("三角函数:", np.sin(a)) # 对每个元素求sin

# 矩阵乘法
A = np.array([[1, 2], [3, 4]])
B = np.array([[5, 6], [7, 8]])
print("矩阵乘法:\n", A @ B)  # 或 np.dot(A, B)

# 其他线性代数运算
print("矩阵求逆:\n", np.linalg.inv(A))
print("行列式:", np.linalg.det(A))
print("特征值:", np.linalg.eig(A)[0])
```

没什么好介绍的，就是简单数学运算

---

### 数学、统计公式

numpy中有自带的数学公式，下面说一些常用的：

```python
# 对数组应用数学公式
arr = np.array([1, 2, 3, 4, 5])

print("平方根:", np.sqrt(arr))          # 对每个元素求平方根
print("指数:", np.exp(arr))             # 对每个元素求e的指数
print("对数:", np.log(arr))             # 对每个元素求自然对数
print("以10为底对数:", np.log10(arr))    # 对每个元素求常用对数

# 三角函数
angles = np.array([0, np.pi/2, np.pi])
print("正弦:", np.sin(angles))          # 对每个元素求正弦
print("余弦:", np.cos(angles))          # 对每个元素求余弦
print("正切:", np.tan(angles))          # 对每个元素求正切

# 统计公式
data = np.array([1, 2, 3, 4, 5, 6])
print("平均值:", np.mean(data))         # 计算平均值
print("标准差:", np.std(data))          # 计算标准差
print("方差:", np.var(data))            # 计算方差
print("总和:", np.sum(data))            # 计算总和

# 对满足条件的元素应用公式
arr = np.array([1, 5, 12, 8, 20, 3])
mask = arr > 10
arr[mask] = arr[mask] * 2 + 1          # 对大于10的元素应用公式：新值=原值×2+1

# 使用where应用不同公式
result = np.where(arr > 5, arr ** 2, arr + 10)  # 大于5的平方，小于等于5的加10
```

### 广播机制

**广播的规则:**

- 让所有输入数组都向其中形状最长的数组看齐，形状中不足的部分都通过在前面加 1 补齐。
- 输出数组的形状是输入数组形状的各个维度上的最大值。
- 如果输入数组的某个维度和输出数组的对应维度的**长度相同**或者其**长度为 1 时**，这个数组能够用来计算，否则出错。
- 当输入数组的某个维度的长度为 1 时，沿着此维度运算时都用此维度上的第一组值。

**简单理解：**对两个数组，分别比较他们的每一个维度（若其中一个数组没有当前维度则忽略），满足：

- 数组拥有相同形状。
- 当前维度的值相等。
- 当前维度的值有一个是 1。

**示例**：

```python
import numpy as np 
 
a = np.array([[ 0, 0, 0],
           [10,10,10],
           [20,20,20],
           [30,30,30]])
b = np.array([0,1,2])
print(a + b)
# 输出：
#[[ 0  1  2]
#[10 11 12]
#[20 21 22]
#[30 31 32]]
```

---

## 5、文件IO

numpy也可以进行文件操作：

```python
# 保存和加载数组
arr = np.array([[1, 2, 3], [4, 5, 6]])

# 保存为文本文件
np.savetxt('array.txt', arr)

# 从文本文件加载
loaded_arr = np.loadtxt('array.txt')

# 保存为二进制文件
np.save('array.npy', arr)
loaded_binary = np.load('array.npy')
```



# 二、Pandas

Pandas是基于Numpy专门进行数据处理的库，提供了DataFrame和Series两种核心数据结构，让数据清洗、转换、分析变得更加简单高效。(虽然在numpy中已经存在了相关的数据清洗与处理功能，但是Pandas更加的方便、强大)

## 1、Series数据结构

Series是Pandas中最基本的一维数据结构，类似于带标签的数组。

### 创建Series

```python
import pandas as pd
import numpy as np

# 从列表创建
s1 = pd.Series([1, 3, 5, 7, 9])
print("从列表创建:")
print(s1)

# 从列表创建并指定索引
s2 = pd.Series([10, 20, 30, 40], index=['a', 'b', 'c', 'd'])
print("\n带自定义索引:")
print(s2)

# 从字典创建（键自动成为索引）
s3 = pd.Series({'北京': 2154, '上海': 2428, '广州': 1867, '深圳': 1756})
print("\n从字典创建:")
print(s3)
```

### Series基本属性

```py
s = pd.Series([10, 20, 30, 40], index=['a', 'b', 'c', 'd'])

print("Series值:", s.values)        # [10 20 30 40]
print("Series索引:", s.index)       # Index(['a', 'b', 'c', 'd'], dtype='object')
print("数据类型:", s.dtype)         # int64
print("元素个数:", s.size)          # 4
print("形状:", s.shape)             # (4,)
```

### Series索引和切片

```python
s = pd.Series([100, 200, 300, 400, 500], index=['A', 'B', 'C', 'D', 'E'])

# 按位置索引
print("第一个元素:", s[0])           # 100
print("前三个元素:", s[:3])          # A:100, B:200, C:300

# 按标签索引
print("标签B的值:", s['B'])          # 200
print("多个标签:", s[['A', 'C', 'E']]) # A:100, C:300, E:500

# 布尔索引
print("大于250的值:", s[s > 250])    # C:300, D:400, E:500
```

### Series常用方法

```py
s = pd.Series([15, 25, 35, 45, 55, 65])

print("描述性统计:")
print("平均值:", s.mean())           # 40.0
print("中位数:", s.median())         # 40.0
print("标准差:", s.std())            # 17.078
print("总和:", s.sum())              # 240
print("最小值:", s.min())            # 15
print("最大值:", s.max())            # 65
```

----

## 2、Dataframe

DataFrame是Pandas中最常用的二维表格数据结构，类似于Excel表格或SQL表。

### 创建DataFrame

```python
# 从字典创建（最常用）
data = {
    '姓名': ['张三', '李四', '王五', '赵六'],
    '年龄': [25, 30, 35, 28],
    '城市': ['北京', '上海', '广州', '深圳'],
    '工资': [5000, 8000, 6000, 7500]
}
df = pd.DataFrame(data, columns=['姓名', '城市', '年龄'],index=['a', 'b', 'c'])

# 指定行索引
df_indexed = pd.DataFrame(data, index=['A', 'B', 'C', 'D'])
```

```
pandas.DataFrame(data=None, index=None, columns=None, dtype=None, copy=False)
```

参数说明：

- `data`：DataFrame 的数据部分，可以是字典、二维数组、Series、DataFrame 或其他可转换为 DataFrame 的对象。如果不提供此参数，则创建一个空的 DataFrame。
- `index`：DataFrame 的行索引，用于标识每行数据。可以是列表、数组、索引对象等。如果不提供此参数，则创建一个默认的整数索引。
- `columns`：DataFrame 的列索引，用于标识每列数据。可以是列表、数组、索引对象等。如果不提供此参数，则创建一个默认的整数索引。
- `dtype`：指定 DataFrame 的数据类型。可以是 NumPy 的数据类型，例如 `np.int64`、`np.float64` 等。如果不提供此参数，则根据数据自动推断数据类型。
- `copy`：是否复制数据。默认为 False，表示不复制数据。如果设置为 True，则复制输入的数据。

### DataFrame 方法

DataFrame 的常用操作和方法如下表所示：

| **方法名称**        | **功能描述**                                                |
| :------------------ | :---------------------------------------------------------- |
| `head(n)`           | 返回 DataFrame 的前 n 行数据（默认前 5 行）                 |
| `tail(n)`           | 返回 DataFrame 的后 n 行数据（默认后 5 行）                 |
| `info()`            | 显示 DataFrame 的简要信息，包括列名、数据类型、非空值数量等 |
| `describe()`        | 返回 DataFrame 数值列的统计信息，如均值、标准差、最小值等   |
| `shape`             | 返回 DataFrame 的行数和列数（行数, 列数）                   |
| `columns`           | 返回 DataFrame 的所有列名                                   |
| `index`             | 返回 DataFrame 的行索引                                     |
| `dtypes`            | 返回每一列的数值数据类型                                    |
| `sort_values(by)`   | 按照指定列排序                                              |
| `sort_index()`      | 按行索引排序                                                |
| `dropna()`          | 删除含有缺失值（NaN）的行或列                               |
| `fillna(value)`     | 用指定的值填充缺失值                                        |
| `isnull()`          | 判断缺失值，返回一个布尔值 DataFrame                        |
| `notnull()`         | 判断非缺失值，返回一个布尔值 DataFrame                      |
| `loc[]`             | 按标签索引选择数据                                          |
| `iloc[]`            | 按位置索引选择数据                                          |
| `at[]`              | 访问 DataFrame 中单个元素（比 `loc[]` 更高效）              |
| `iat[]`             | 访问 DataFrame 中单个元素（比 `iloc[]` 更高效）             |
| `apply(func)`       | 对 DataFrame 或 Series 应用一个函数                         |
| `applymap(func)`    | 对 DataFrame 的每个元素应用函数（仅对 DataFrame）           |
| `groupby(by)`       | 分组操作，用于按某一列分组进行汇总统计                      |
| `pivot_table()`     | 创建透视表                                                  |
| `merge()`           | 合并多个 DataFrame（类似 SQL 的 JOIN 操作）                 |
| `concat()`          | 按行或按列连接多个 DataFrame                                |
| `to_csv()`          | 将 DataFrame 导出为 CSV 文件                                |
| `to_excel()`        | 将 DataFrame 导出为 Excel 文件                              |
| `to_json()`         | 将 DataFrame 导出为 JSON 格式                               |
| `to_sql()`          | 将 DataFrame 导出为 SQL 数据库                              |
| `query()`           | 使用 SQL 风格的语法查询 DataFrame                           |
| `duplicated()`      | 返回布尔值 DataFrame，指示每行是否是重复的                  |
| `drop_duplicates()` | 删除重复的行                                                |
| `set_index()`       | 设置 DataFrame 的索引                                       |
| `reset_index()`     | 重置 DataFrame 的索引                                       |
| `transpose()`       | 转置 DataFrame（行列交换）                                  |

----

## 3、Pandas文件操作

这些函数的参数有点多，建议要用的时候再去查开发文档即可

### CSV文件

- **read_csv()** 是从 CSV 文件中读取数据的主要方法，将数据加载为一个 DataFrame。

```
import pandas as pd

# 读取 CSV 文件，并自定义列名和分隔符
df = pd.read_csv('data.csv', sep=';', header=0, names=['A', 'B', 'C'], dtype={'A': int, 'B': float})
print(df)
```

- **to_csv()** 是将 DataFrame 写入 CSV 文件的方法，支持自定义分隔符、列名、是否包含索引等设置。

```
import pandas as pd

# 假设 df 是一个已有的 DataFrame
df.to_csv('output.csv', index=False, header=True, columns=['A', 'B'])
```

- 例子

实现了一个简单的读写逻辑

```python
df=pd.read_csv('data.csv')
print(df.head())#打印前五个并转为字符串
print(df.tail().to_string())#打印后五个并转为字符串
print(df.describe().to_string())#描述性统计
#使用前文的其他方法进行处理
df.drop_duplicates()#去掉重复的
df.to_csv('data_out.csv',index=False)#保存为csv文件
```

### Excel文件

- **read_xlsx()** 是从 CSV 文件中读取数据的主要方法，将数据加载为一个 DataFrame。

```python
import pandas as pd

# 读取 data.xlsx 文件
df = pd.read_excel('data.xlsx')

# 打印读取的 DataFrame
print(df)
```

- **DataFrame.to_excel() ** 将 DataFrame 写入 Excel 文件

```python
import pandas as pd

# 创建一个简单的 DataFrame
df = pd.DataFrame({
'Name': ['Alice', 'Bob', 'Charlie'],
'Age': [25, 30, 35],
'City': ['New York', 'Los Angeles', 'Chicago']
})

# 将 DataFrame 写入 Excel 文件，写入 'Sheet1' 表单
df.to_excel('output.xlsx', sheet_name='Sheet1', index=False)

# 写入多个表单，使用 ExcelWriter
with pd.ExcelWriter('output.xlsx') as writer:
df.to_excel(writer, sheet_name='Sheet1', index=False)
df.to_excel(writer, sheet_name='Sheet2', index=False)
```

### Json文件

Pandas 提供了强大的方法来处理 JSON 格式的数据，支持从 JSON 文件或字符串中读取数据并将其转换为 DataFrame，以及将 DataFrame 转换回 JSON 格式。

| **操作**                    | **方法**              | **说明**                                                |
| :-------------------------- | :-------------------- | :------------------------------------------------------ |
| 从 JSON 文件/字符串读取数据 | `pd.read_json()`      | 从 JSON 数据中读取并加载为 DataFrame                    |
| 将 DataFrame 转换为 JSON    | `DataFrame.to_json()` | 将 DataFrame 转换为 JSON 格式的数据，可以指定结构化方式 |
| 支持 JSON 结构化方式        | `orient` 参数         | 支持多种结构化方式，如 `split`、`records`、`columns`    |

- **read_json()** 用于从 JSON 格式的数据中读取并加载为一个 DataFrame。它支持从 JSON 文件、JSON 字符串或 JSON 网址中加载数据。

```python
import pandas as pd

df = pd.read_json('sites.json')
   
data=df.to_string()

df = pd.DataFrame(data)

print(df)
```

- **to_json() **方法用于将 DataFrame 转换为 JSON 格式的数据，可以指定 JSON 的结构化方式。

```python
import pandas as pd

# 创建 DataFrame
df = pd.DataFrame({
    'Name': ['Alice', 'Bob', 'Charlie'],
    'Age': [25, 30, 35],
    'City': ['New York', 'Los Angeles', 'Chicago']
})

# 将 DataFrame 转换为 JSON 文件，指定 orient='records'
df.to_json('data.json', orient='records', lines=True)

# 输出生成的文件内容：
# [
#   {"Name":"Alice","Age":25,"City":"New York"},
#   {"Name":"Bob","Age":30,"City":"Los Angeles"},
#   {"Name":"Charlie","Age":35,"City":"Chicago"}
# ]
```

### 简单示例

```python
df=pd.read_csv('data.csv')
print(df.head())#打印前五个并转为字符串
print(df.tail().to_string())#打印后五个并转为字符串
print(df.describe().to_string())#描述性统计
#使用前文的其他方法进行处理
df.drop_duplicates()#去重
df.to_csv('data_out.csv',index=False)#保存为csv文件
```

---

## 4、数据清洗与处理

数据清洗与处理的常见方法（大致了解即可，不要背不要记）：

| **操作**               | **方法/步骤**                | **说明**                                                     | **常用函数/方法**                                        |
| :--------------------- | :--------------------------- | :----------------------------------------------------------- | :------------------------------------------------------- |
| **缺失值处理**         | 填充缺失值                   | 使用指定的值（如均值、中位数、众数等）填充缺失值。           | `df.fillna(value)`                                       |
|                        | 删除缺失值                   | 删除包含缺失值的行或列。                                     | `df.dropna()`                                            |
| **重复数据处理**       | 删除重复数据                 | 删除 DataFrame 中的重复行。                                  | `df.drop_duplicates()`                                   |
| **异常值处理**         | 异常值检测（基于统计方法）   | 通过 Z-score 或 IQR 方法识别并处理异常值。                   | 自定义函数（如基于 Z-score 或 IQR）                      |
|                        | 替换异常值                   | 使用合适的值（如均值或中位数）替换异常值。                   | 自定义函数（如替换异常值）                               |
| **数据格式转换**       | 转换数据类型                 | 将数据类型从一个类型转换为另一个类型，如将字符串转换为日期。 | `df.astype()`                                            |
|                        | 日期时间格式转换             | 转换字符串或数字为日期时间类型。                             | `pd.to_datetime()`                                       |
| **标准化与归一化**     | 标准化                       | 将数据转换为均值为0，标准差为1的分布。                       | `StandardScaler()`                                       |
|                        | 归一化                       | 将数据缩放到指定的范围（如 [0, 1]）。                        | `MinMaxScaler()`                                         |
| **类别数据编码**       | 标签编码                     | 将类别变量转换为整数形式。                                   | `LabelEncoder()`                                         |
|                        | 独热编码（One-Hot Encoding） | 将每个类别转换为一个新的二进制特征。                         | `pd.get_dummies()`                                       |
| **文本数据处理**       | 去除停用词                   | 从文本中去除无关紧要的词，如 "the" 、 "is" 等。              | 自定义函数（基于 `nltk` 或 `spaCy`）                     |
|                        | 词干化与词形还原             | 提取词干或恢复单词的基本形式。                               | `nltk.stem.PorterStemmer()`                              |
|                        | 分词                         | 将文本分割成单词或子词。                                     | `nltk.word_tokenize()`                                   |
| **数据抽样**           | 随机抽样                     | 从数据中随机抽取一定比例的样本。                             | `df.sample()`                                            |
|                        | 上采样与下采样               | 通过过采样（复制少数类样本）或欠采样（减少多数类样本）来平衡数据集中的类别分布。 | `SMOTE()`（上采样）； `RandomUnderSampler()`（下采样）   |
| **特征工程**           | 特征选择                     | 选择对目标变量有影响的特征，去除冗余或无关特征。             | `SelectKBest()`                                          |
|                        | 特征提取                     | 从原始数据中创建新的特征，提升模型的预测能力。               | `PolynomialFeatures()`                                   |
|                        | 特征缩放                     | 对数值特征进行缩放，使其具有相同的量级。                     | `MinMaxScaler()` 、 `StandardScaler()`                   |
| **类别特征映射**       | 特征映射                     | 将类别变量映射为对应的数字编码。                             | 自定义映射函数                                           |
| **数据合并与连接**     | 合并数据                     | 将多个 DataFrame 按照某些列合并在一起，支持内连接、外连接、左连接、右连接等。 | `pd.merge()`                                             |
|                        | 连接数据                     | 将多个 DataFrame 进行行或列拼接。                            | `pd.concat()`                                            |
| **数据重塑**           | 数据透视表                   | 将数据根据某些维度进行分组并计算聚合结果。                   | `pd.pivot_table()`                                       |
|                        | 数据变形                     | 改变数据的形状，如从长格式转为宽格式或从宽格式转为长格式。   | `df.melt()` 、 `df.pivot()`                              |
| **数据类型转换与处理** | 字符串处理                   | 对字符串数据进行处理，如去除空格、转换大小写等。             | `str.replace()` 、 `str.upper()` 等                      |
|                        | 分组计算                     | 按照某个特征分组后进行聚合计算。                             | `df.groupby()`                                           |
| **缺失值预测填充**     | 使用模型预测填充缺失值       | 使用机器学习模型（如回归模型）预测缺失值，并填充缺失数据。   | 自定义模型（如 `sklearn.linear_model.LinearRegression`） |
| **时间序列处理**       | 时间序列缺失值填充           | 使用时间序列的方法（如前向填充、后向填充）填充缺失值。       | `df.fillna(method='ffill')`                              |
|                        | 滚动窗口计算                 | 使用滑动窗口进行时间序列数据的统计计算（如均值、标准差等）。 | `df.rolling(window=5).mean()`                            |
| **数据转换与映射**     | 数据映射与替换               | 将数据中的某些值替换为其他值。                               | `df.replace()`                                           |

**相应例子**:

- 缺失数据处理：

```python
import pandas as pd

# 示例数据
data = {'Name': ['Alice', 'Bob', 'Charlie', None],
        'Age': [25, 30, None, 35],
        'City': ['New York', 'Los Angeles', 'Chicago', 'Houston']}

df = pd.DataFrame(data)

# 填充缺失的 "Age" 为均值
df['Age'].fillna(df['Age'].mean(), inplace=True)
df.dropna()#丢弃缺失数据
df.dropna(tresh=2)#至少有两个缺失值才丢弃
```

- 重复数据处理：

```python
df=pd.DataFrame({
    'name':['alice','alice','bob','charlie','david'],
    'score':[85,85,78,92,88],
    'city':['New York','New York','Los Angeles','Chicago','Houston']
})

df_processed=df.drop_duplicates(keep='last')#删除重复数据，保留最后一个
print(df_processed)
```

- 独热编码：

```python
import pandas as pd

# 示例数据
data = {'City': ['New York', 'Los Angeles', 'Chicago', 'Houston']}

df = pd.DataFrame(data)

# 对 "City" 列进行 One-Hot 编码
df_encoded = pd.get_dummies(df, columns=['City'])
```

- 标准化：

```python
from sklearn.preprocessing import StandardScaler
import pandas as pd

# 示例数据
data = {'Age': [25, 30, 35, 40, 45],
    'Salary': [50000, 60000, 70000, 80000, 90000]}

df = pd.DataFrame(data)

# 标准化数据
scaler = StandardScaler()
df_scaled = scaler.fit_transform(df)
```

- 分组聚合

```python
import pandas as pd

# 示例数据
data = {'Department': ['HR', 'Finance', 'HR', 'IT', 'IT'],
        'Employee': ['Alice', 'Bob', 'Charlie', 'David', 'Eve'],
        'Salary': [50000, 60000, 55000, 70000, 75000]}

df = pd.DataFrame(data)

# 按照部门分组，并计算每个部门的平均薪资
grouped = df.groupby('Department')['Salary'].mean()
print(grouped)
```

 

# 三、Matplotlib

前文我们已经储存了数据，处理了数据，现在该轮到画图了

## 1、简单绘图

### 折线图 

创建折线图可以使用**plot()**函数

```python
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd

# 基本折线图
x = np.linspace(0, 10, 100)
y = np.sin(x)

plt.figure(figsize=(10, 6))#创建一个10×6的图画窗口
plt.plot(x, y, label='sin(x)', color='blue', linewidth=2, linestyle='-', marker='')#创建一个线图
plt.title('正弦函数折线图')#设置图片标题
plt.xlabel('X 轴')#设置x坐标
plt.ylabel('Y 轴')#设置y坐标
plt.legend()#显示图例，让人知道哪条线是哪条线
plt.grid(True, alpha=0.3)#添加网格线
plt.show()#展示图

# 多线条折线图
plt.figure(figsize=(10, 6))
plt.plot(x, np.sin(x), label='sin(x)', linewidth=2)
plt.plot(x, np.cos(x), label='cos(x)', linewidth=2)
plt.plot(x, np.sin(x) + np.cos(x), label='sin(x)+cos(x)', linewidth=2)
plt.title('多函数折线图')
plt.legend()
plt.show()
```

### 条形图

创建条形图主要使用**matplotlib.pyplot.bar(x, height, width=0.8, bottom=None, *, align='center', data=None, *\*kwargs**)函数

**参数说明：**

- **x**：浮点型数组，柱形图的 x 轴数据。

- **height**：浮点型数组，柱形图的高度。

- **width**：浮点型数组，柱形图的宽度。

- **bottom**：浮点型数组，底座的 y 坐标，默认 0。

- **align**：柱形图与 x 坐标的对齐方式，'center' 以 x 位置为中心，这是默认值。 'edge'：将柱形图的左边缘与 x 位置对齐。要对齐右边缘的条形，可以传递负数的宽度值及 align='edge'。

- ***\*kwargs：**：其他参数。

```python
# 垂直条形图
categories = ['产品A', '产品B', '产品C', '产品D', '产品E']
sales = [120, 85, 150, 95, 130]

plt.figure(figsize=(10, 6))
plt.bar(categories, sales, color=['#ff9999', '#66b3ff', '#99ff99', '#ffcc99', '#ff99cc'])
plt.title('产品销售额条形图')
plt.xlabel('产品类别')
plt.ylabel('销售额（万元）')
plt.grid(True, alpha=0.3, axis='y')

# 在条形上添加数值标签
for i, v in enumerate(sales):
    plt.text(i, v + 2, str(v), ha='center', va='bottom')

plt.show()

# 水平条形图
plt.figure(figsize=(10, 6))
plt.barh(categories, sales, color='skyblue')
plt.title('产品销售额水平条形图')
plt.xlabel('销售额（万元）')
plt.ylabel('产品类别')
plt.grid(True, alpha=0.3, axis='x')
plt.show()
```

### 散点图

创建散点图使用**matplotlib.pyplot.scatter()**函数

```python
# 基本散点图
np.random.seed(42)
x = np.random.randn(100)
y = np.random.randn(100)
colors = np.random.rand(100)
sizes = 100 * np.random.rand(100)

plt.figure(figsize=(10, 6))
plt.scatter(x, y, c=colors, s=sizes, alpha=0.7, cmap='viridis')#创建散点图
plt.colorbar(label='颜色值')
plt.title('散点图示例')
plt.xlabel('X 值')
plt.ylabel('Y 值')
plt.grid(True, alpha=0.3)
plt.show()
```

### 直方图

创建直方图使用**matplotlib.pyplot.hist()**函数

```python
# 数据分布直方图
data = np.random.normal(0, 1, 1000)

plt.figure(figsize=(10, 6))
plt.hist(data, bins=30, alpha=0.7, color='lightblue', edgecolor='black')#创建直方图
plt.title('数据分布直方图')
plt.xlabel('数值')
plt.ylabel('频数')
plt.grid(True, alpha=0.3)
plt.show()

# 多组数据直方图
data1 = np.random.normal(0, 1, 1000)
data2 = np.random.normal(2, 1.5, 1000)

plt.figure(figsize=(10, 6))
plt.hist(data1, bins=30, alpha=0.5, label='数据集1', color='blue')
plt.hist(data2, bins=30, alpha=0.5, label='数据集2', color='red')
plt.title('多数据集直方图')
plt.legend()
plt.show()
```

### 饼图

创建饼图使用**matplotlib.pyplot.hist()**函数

```python
# 基本饼图
labels = ['产品A', '产品B', '产品C', '产品D']
sizes = [30, 25, 20, 25]
colors = ['#ff9999', '#66b3ff', '#99ff99', '#ffcc99']
explode = (0.1, 0, 0, 0)  # 突出显示第一部分

plt.figure(figsize=(8, 8))
plt.pie(sizes, explode=explode, labels=labels, colors=colors, 
        autopct='%1.1f%%', shadow=True, startangle=90)#创建饼图
plt.title('产品市场份额饼图')
plt.axis('equal')  # 保证饼图是圆形
plt.show()
```

----

## 2、ax对象

这是面向对象编程的一种实现,可以代表整体的图表

### 理解 ax 对象

```python
# 创建 Figure 和 Axes 对象
fig, ax = plt.subplots(figsize=(10, 6))

# ax 对象的主要方法
x = np.linspace(0, 10, 100)
y1 = np.sin(x)
y2 = np.cos(x)

# 绘图方法
ax.plot(x, y1, label='sin(x)', color='blue', linewidth=2)
ax.plot(x, y2, label='cos(x)', color='red', linewidth=2)

# 设置方法（注意：使用 set_ 前缀）
ax.set_title('三角函数图像')        # 设置标题
ax.set_xlabel('X 轴')             # 设置x轴标签
ax.set_ylabel('Y 轴')             # 设置y轴标签
ax.set_xlim(0, 10)                # 设置x轴范围
ax.set_ylim(-1.5, 1.5)            # 设置y轴范围

# 其他配置
ax.legend()                       # 显示图例
ax.grid(True, alpha=0.3)          # 显示网格
ax.set_facecolor('#f8f9fa')       # 设置背景色

plt.show()
```

### ax 对象的常用方法

```python
# 展示 ax 对象的多种方法
fig, ax = plt.subplots(figsize=(12, 8))

# 生成数据
x = np.linspace(0, 4*np.pi, 100)

# 1. 绘制多条线
ax.plot(x, np.sin(x), label='sin(x)', color='blue', linewidth=2)
ax.plot(x, np.cos(x), label='cos(x)', color='red', linewidth=2)

# 2. 添加参考线
ax.axhline(y=0, color='black', linewidth=0.8, linestyle='--')  # 水平参考线
ax.axvline(x=np.pi, color='green', linewidth=0.8, linestyle=':')  # 垂直参考线

# 3. 添加填充区域
ax.fill_between(x, np.sin(x), np.cos(x), alpha=0.3, color='yellow')

# 4. 添加文本注释
ax.text(2, 0.5, '重要区域', fontsize=12)

# 5. 设置坐标轴属性
ax.set_xlim(0, 4*np.pi)
ax.set_ylim(-1.5, 1.5)
ax.set_xticks([0, np.pi, 2*np.pi, 3*np.pi, 4*np.pi])
ax.set_xticklabels(['0', 'π', '2π', '3π', '4π'])

# 6. 添加图例和网格
ax.legend()
ax.grid(True, alpha=0.3)

# 7. 设置标题和标签
ax.set_title('三角函数分析')
ax.set_xlabel('角度 (radians)')
ax.set_ylabel('函数值')

plt.show()
```

### 利用ax画多图

```python
#创建多个子图
ax1 = plt.subplot(2, 2, 1)
ax2 = plt.subplot(2, 2, 2)
ax3 = plt.subplot(2, 2, 3)
ax4 = plt.subplot(2, 2, 4)

# 为每个 ax 绘制不同的内容
x = np.linspace(0, 10, 100)

# ax1: 线图
ax1.plot(x, np.sin(x))
ax1.set_title('正弦函数')

# ax2: 散点图
ax2.scatter(x, np.cos(x))
ax2.set_title('余弦散点')

# ax3: 条形图
categories = ['A', 'B', 'C', 'D']
values = [25, 40, 30, 35]
ax3.bar(categories, values)
ax3.set_title('分类数据')

# ax4: 直方图
data = np.random.normal(0, 1, 1000)
ax4.hist(data, bins=20)
ax4.set_title('数据分布')

plt.tight_layout()#自动优化布局
plt.show()
```

---

## 3、中文设置

在使用中文和负号作为横纵坐标的标题时会发现打出来是乱码，这个时候你就需要引入字体，它不需要你去额外下载东西，只需要你引入系统的字体就行

### 解决显示问题

```python
# 使用中文字体
plt.rcParams['font.sans-serif'] = ['SimHei']  # windows解决方案
plt.rcParams['axes.unicode_minus'] = False    # linux解决方案
plt.rcParams['font.family'] = 'Heiti TC'  # mac解决方案
plt.rcParams['axes.unicode_minus'] = False    # 解决负号显示问题
```

---

## 4、保存图表

如果用 `fig = plt.figure()` 创建了画布，直接用 `fig.savefig()` 保存

```python
# 创建画布和2×2子图（沿用你的代码）
fig = plt.figure(figsize=(12, 8))
ax1 = fig.add_subplot(2, 2, 1)
ax2 = fig.add_subplot(2, 2, 2)
ax3 = fig.add_subplot(2, 2, 3)
ax4 = fig.add_subplot(2, 2, 4)

# 绘制子图
x = np.linspace(0, 10, 100)
ax1.plot(x, np.sin(x)); ax1.set_title('正弦函数')
ax2.scatter(x, np.cos(x)); ax2.set_title('余弦散点')
ax3.bar(['A','B','C','D'], [25,40,30,35]); ax3.set_title('分类数据')
ax4.hist(np.random.normal(0,1,1000), bins=20); ax4.set_title('数据分布')

# 保存图表
fig.savefig('多子图图表.png')  # 保存路径+文件名

# 最后显示图像
plt.show()
```

如果用 `plt.plot()` 快速绘图（无 `fig+ax`），用 `plt.savefig()`：

```python
plt.plot(x, np.sin(x))
plt.title('正弦函数')
plt.tight_layout()
plt.savefig('单图.png', dpi=300, bbox_inches='tight')  # 保存
plt.show()  # 显示
```

- 注意，一定要先保存再show()

# 四、seaborn

seaborn是对matplotlib的二次封装，功能会更强大一点,可以让你用更少的代码创建更美观的图。这里简述一下，详细了解官方文档[用户指南与教程 — seaborn 0.13.2 文档](https://seaborn.pydata.org/tutorial.html)

## 1、更美观的样式

Seaborn 提供了多种内置主题和颜色调色板，可以通过设置来改变图形的外观。

```python
import seaborn as sns

# 设置主题和颜色调色板
sns.set_theme(style="whitegrid")
```

主题：

- **darkgrid**（默认）：深色网格主题。
- **whitegrid**：浅色网格主题。
- **dark**：深色主题，没有网格。

除此之外还有很多

## 2、更方便的图表绘制

使用seaborn创建图表他会给你自带一些功能和更美观的默认样式，除此之外，传入的参数也更加的简洁方便

举例一下：

- 散点图 - sns.scatterplot()

- 折线图 - sns.lineplot()
- 柱状图 - sns.barplot()

- 热图 - sns.heatmap()



# 结语

上面就已经讲完了最基础的数据处理三大库，但是更多的需要自己去探索和实践
